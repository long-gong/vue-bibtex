'use strict';

exports.__esModule = true;

var _events = require('events');

var _events2 = _interopRequireDefault(_events);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const TERMINATION_TYPES = {
    sigint: 'sigint',
    sigbreak: 'sigbreak',
    shutdown: 'shutdown'
};

const TERMINATION_LEVEL_INCREASED_EVENT = 'termination-level-increased';

class TerminationHandler extends _events2.default {
    constructor() {
        super();

        this.handledSignalsCount = {
            [TERMINATION_TYPES.sigint]: 0,
            [TERMINATION_TYPES.sigbreak]: 0,
            [TERMINATION_TYPES.shutdown]: 0
        };

        this.terminationLevel = 0;

        this._setupHandlers();
    }

    _exitEventHandler(terminationType) {
        this.handledSignalsCount[terminationType]++;

        if (this.handledSignalsCount[terminationType] > this.terminationLevel) {
            this.terminationLevel = this.handledSignalsCount[terminationType];

            this.emit(TERMINATION_LEVEL_INCREASED_EVENT, this.terminationLevel);
        }
    }

    _setupHandlers() {
        process.on('SIGINT', () => this._exitEventHandler(TERMINATION_TYPES.sigint));
        process.on('SIGBREAK', () => this._exitEventHandler(TERMINATION_TYPES.sigbreak));

        process.on('message', message => message === 'shutdown' && this._exitEventHandler(TERMINATION_TYPES.shutdown));
    }
}

exports.default = TerminationHandler;
TerminationHandler.TERMINATION_LEVEL_INCREASED_EVENT = TERMINATION_LEVEL_INCREASED_EVENT;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvdGVybWluYXRpb24taGFuZGxlci5qcyJdLCJuYW1lcyI6WyJURVJNSU5BVElPTl9UWVBFUyIsInNpZ2ludCIsInNpZ2JyZWFrIiwic2h1dGRvd24iLCJURVJNSU5BVElPTl9MRVZFTF9JTkNSRUFTRURfRVZFTlQiLCJUZXJtaW5hdGlvbkhhbmRsZXIiLCJFdmVudEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsImhhbmRsZWRTaWduYWxzQ291bnQiLCJ0ZXJtaW5hdGlvbkxldmVsIiwiX3NldHVwSGFuZGxlcnMiLCJfZXhpdEV2ZW50SGFuZGxlciIsInRlcm1pbmF0aW9uVHlwZSIsImVtaXQiLCJwcm9jZXNzIiwib24iLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7OztBQUdBLE1BQU1BLG9CQUFvQjtBQUN0QkMsWUFBVSxRQURZO0FBRXRCQyxjQUFVLFVBRlk7QUFHdEJDLGNBQVU7QUFIWSxDQUExQjs7QUFNQSxNQUFNQyxvQ0FBb0MsNkJBQTFDOztBQUVlLE1BQU1DLGtCQUFOLFNBQWlDQyxnQkFBakMsQ0FBOEM7QUFDekRDLGtCQUFlO0FBQ1g7O0FBRUEsYUFBS0MsbUJBQUwsR0FBMkI7QUFDdkIsYUFBQ1Isa0JBQWtCQyxNQUFuQixHQUE4QixDQURQO0FBRXZCLGFBQUNELGtCQUFrQkUsUUFBbkIsR0FBOEIsQ0FGUDtBQUd2QixhQUFDRixrQkFBa0JHLFFBQW5CLEdBQThCO0FBSFAsU0FBM0I7O0FBTUEsYUFBS00sZ0JBQUwsR0FBd0IsQ0FBeEI7O0FBRUEsYUFBS0MsY0FBTDtBQUNIOztBQUVEQyxzQkFBbUJDLGVBQW5CLEVBQW9DO0FBQ2hDLGFBQUtKLG1CQUFMLENBQXlCSSxlQUF6Qjs7QUFFQSxZQUFJLEtBQUtKLG1CQUFMLENBQXlCSSxlQUF6QixJQUE0QyxLQUFLSCxnQkFBckQsRUFBdUU7QUFDbkUsaUJBQUtBLGdCQUFMLEdBQXdCLEtBQUtELG1CQUFMLENBQXlCSSxlQUF6QixDQUF4Qjs7QUFFQSxpQkFBS0MsSUFBTCxDQUFVVCxpQ0FBVixFQUE2QyxLQUFLSyxnQkFBbEQ7QUFDSDtBQUNKOztBQUVEQyxxQkFBa0I7QUFDZEksZ0JBQVFDLEVBQVIsQ0FBVyxRQUFYLEVBQXFCLE1BQU0sS0FBS0osaUJBQUwsQ0FBdUJYLGtCQUFrQkMsTUFBekMsQ0FBM0I7QUFDQWEsZ0JBQVFDLEVBQVIsQ0FBVyxVQUFYLEVBQXVCLE1BQU0sS0FBS0osaUJBQUwsQ0FBdUJYLGtCQUFrQkUsUUFBekMsQ0FBN0I7O0FBRUFZLGdCQUFRQyxFQUFSLENBQVcsU0FBWCxFQUFzQkMsV0FBV0EsWUFBWSxVQUFaLElBQTBCLEtBQUtMLGlCQUFMLENBQXVCWCxrQkFBa0JHLFFBQXpDLENBQTNEO0FBQ0g7QUE5QndEOztrQkFBeENFLGtCO0FBaUNyQkEsbUJBQW1CRCxpQ0FBbkIsR0FBdURBLGlDQUF2RCIsImZpbGUiOiJjbGkvdGVybWluYXRpb24taGFuZGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBFdmVudEVtaXR0ZXIgZnJvbSAnZXZlbnRzJztcblxuXG5jb25zdCBURVJNSU5BVElPTl9UWVBFUyA9IHtcbiAgICBzaWdpbnQ6ICAgJ3NpZ2ludCcsXG4gICAgc2lnYnJlYWs6ICdzaWdicmVhaycsXG4gICAgc2h1dGRvd246ICdzaHV0ZG93bidcbn07XG5cbmNvbnN0IFRFUk1JTkFUSU9OX0xFVkVMX0lOQ1JFQVNFRF9FVkVOVCA9ICd0ZXJtaW5hdGlvbi1sZXZlbC1pbmNyZWFzZWQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXJtaW5hdGlvbkhhbmRsZXIgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yICgpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmhhbmRsZWRTaWduYWxzQ291bnQgPSB7XG4gICAgICAgICAgICBbVEVSTUlOQVRJT05fVFlQRVMuc2lnaW50XTogICAwLFxuICAgICAgICAgICAgW1RFUk1JTkFUSU9OX1RZUEVTLnNpZ2JyZWFrXTogMCxcbiAgICAgICAgICAgIFtURVJNSU5BVElPTl9UWVBFUy5zaHV0ZG93bl06IDBcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnRlcm1pbmF0aW9uTGV2ZWwgPSAwO1xuXG4gICAgICAgIHRoaXMuX3NldHVwSGFuZGxlcnMoKTtcbiAgICB9XG5cbiAgICBfZXhpdEV2ZW50SGFuZGxlciAodGVybWluYXRpb25UeXBlKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlZFNpZ25hbHNDb3VudFt0ZXJtaW5hdGlvblR5cGVdKys7XG5cbiAgICAgICAgaWYgKHRoaXMuaGFuZGxlZFNpZ25hbHNDb3VudFt0ZXJtaW5hdGlvblR5cGVdID4gdGhpcy50ZXJtaW5hdGlvbkxldmVsKSB7XG4gICAgICAgICAgICB0aGlzLnRlcm1pbmF0aW9uTGV2ZWwgPSB0aGlzLmhhbmRsZWRTaWduYWxzQ291bnRbdGVybWluYXRpb25UeXBlXTtcblxuICAgICAgICAgICAgdGhpcy5lbWl0KFRFUk1JTkFUSU9OX0xFVkVMX0lOQ1JFQVNFRF9FVkVOVCwgdGhpcy50ZXJtaW5hdGlvbkxldmVsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9zZXR1cEhhbmRsZXJzICgpIHtcbiAgICAgICAgcHJvY2Vzcy5vbignU0lHSU5UJywgKCkgPT4gdGhpcy5fZXhpdEV2ZW50SGFuZGxlcihURVJNSU5BVElPTl9UWVBFUy5zaWdpbnQpKTtcbiAgICAgICAgcHJvY2Vzcy5vbignU0lHQlJFQUsnLCAoKSA9PiB0aGlzLl9leGl0RXZlbnRIYW5kbGVyKFRFUk1JTkFUSU9OX1RZUEVTLnNpZ2JyZWFrKSk7XG5cbiAgICAgICAgcHJvY2Vzcy5vbignbWVzc2FnZScsIG1lc3NhZ2UgPT4gbWVzc2FnZSA9PT0gJ3NodXRkb3duJyAmJiB0aGlzLl9leGl0RXZlbnRIYW5kbGVyKFRFUk1JTkFUSU9OX1RZUEVTLnNodXRkb3duKSk7XG4gICAgfVxufVxuXG5UZXJtaW5hdGlvbkhhbmRsZXIuVEVSTUlOQVRJT05fTEVWRUxfSU5DUkVBU0VEX0VWRU5UID0gVEVSTUlOQVRJT05fTEVWRUxfSU5DUkVBU0VEX0VWRU5UO1xuIl19
